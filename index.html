<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fixeve Timer</title>
<style>
  body {
    background-color: #eef6ff;
    font-family: "Arial", sans-serif;
    text-align: center;
    padding: 30px;
  }
  h1 { margin-bottom: 10px; }
  #timer {
    font-size: 64px;
    margin: 20px 0;
  }
  button {
    font-size: 20px;
    margin: 10px;
    padding: 10px 30px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  .start { background-color: #4caf50; color: white; }
  .pause { background-color: #ff9800; color: white; }
  .stop { background-color: #f44336; color: white; }
  select {
    padding: 8px;
    font-size: 18px;
  }
  #home {
    display: block;
    margin-top: 30px;
    color: #007bff;
    text-decoration: none;
  }
</style>
</head>
<body>
  <h1>タイマー</h1>

  <label for="mode">モード選択：</label>
  <select id="mode">
    <option value="up">カウントアップ</option>
    <option value="pomodoro">25分勉強 / 5分休憩</option>
    <option value="focus50">50分勉強 / 10分休憩</option>
  </select>

  <div id="timer">00:00</div>
  <div id="status">停止中</div>

  <button class="start" id="startBtn">開始</button>
  <button class="pause" id="pauseBtn">中断</button>
  <button class="stop" id="stopBtn">終了</button>

  <a id="home" href="https://fixeve.github.io/fixeve-home/">ホームに戻る</a>

<script>
let timerDisplay = document.getElementById("timer");
let statusDisplay = document.getElementById("status");
let startBtn = document.getElementById("startBtn");
let pauseBtn = document.getElementById("pauseBtn");
let stopBtn = document.getElementById("stopBtn");
let modeSelect = document.getElementById("mode");

let timer = null;
let timeLeft = 0;
let isRunning = false;
let isStudy = true;
let setCount = 1;

// 日付リセットチェック
const todayKey = () => {
  const now = new Date();
  now.setHours(now.getHours() + 9); // 日本時間
  return now.toISOString().split("T")[0];
};

function checkDailyReset() {
  const savedDate = localStorage.getItem("fixeve_date");
  const today = todayKey();
  if (savedDate !== today) {
    localStorage.setItem("fixeve_date", today);
    localStorage.setItem("fixeve_studyTime", "0");
  }
}
checkDailyReset();

function updateDisplay() {
  const minutes = String(Math.floor(timeLeft / 60)).padStart(2, "0");
  const seconds = String(timeLeft % 60).padStart(2, "0");
  timerDisplay.textContent = `${minutes}:${seconds}`;
}

function startTimer() {
  if (isRunning) return;
  isRunning = true;
  statusDisplay.textContent = isStudy ? "勉強中" : "休憩中";
  timer = setInterval(() => {
    if (modeSelect.value === "up") {
      timeLeft++;
    } else {
      timeLeft--;
      if (timeLeft < 0) {
        clearInterval(timer);
        isRunning = false;
        if (isStudy) {
          let sec = parseInt(localStorage.getItem("fixeve_studyTime") || "0");
          localStorage.setItem("fixeve_studyTime", sec + (modeSelect.value === "pomodoro" ? 1500 : 3000));
        }
        isStudy = !isStudy;
        if (isStudy) {
          setCount++;
          let longBreak = (modeSelect.value === "pomodoro" ? 900 : 1800);
          let shortBreak = (modeSelect.value === "pomodoro" ? 300 : 600);
          timeLeft = (setCount % 5 === 0) ? longBreak : (modeSelect.value === "pomodoro" ? 1500 : 3000);
        } else {
          timeLeft = (modeSelect.value === "pomodoro" ? 300 : 600);
        }
        updateDisplay();
        startTimer();
      }
    }
    updateDisplay();
  }, 1000);
}

function pauseTimer() {
  if (!isRunning) return;
  clearInterval(timer);
  isRunning = false;
  statusDisplay.textContent = "一時停止中";
}

function stopTimer() {
  clearInterval(timer);
  isRunning = false;
  isStudy = true;
  timeLeft = 0;
  setCount = 1;
  updateDisplay();
  statusDisplay.textContent = "停止中";
}

startBtn.onclick = () => {
  if (modeSelect.value === "up" && timeLeft === 0) timeLeft = 0;
  if (modeSelect.value === "pomodoro" && timeLeft === 0) timeLeft = 1500;
  if (modeSelect.value === "focus50" && timeLeft === 0) timeLeft = 3000;
  startTimer();
};
pauseBtn.onclick = pauseTimer;
stopBtn.onclick = stopTimer;

updateDisplay();
</script>
</body>
</html>
