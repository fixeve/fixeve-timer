<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>タイマー | Fixeve</title>
<style>
    body {
        font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
        text-align: center;
        background-color: #ffffff;
        color: #000;
        margin: 0;
        padding: 0;
    }
    h1 {
        margin-top: 25px;
        font-size: 26px;
        color: #007BFF;
    }
    #timer {
        font-size: 64px;
        font-weight: bold;
        margin: 40px 0;
    }
    .buttons {
        margin: 20px;
    }
    button {
        margin: 10px;
        font-size: 18px;
        padding: 10px 25px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: 0.2s;
    }
    #startBtn { background-color: #007bff; color: white; }
    #pauseBtn { background-color: #ffcc00; color: black; }
    #stopBtn  { background-color: #ff4444; color: white; }
    button:hover {
        opacity: 0.8;
        transform: scale(1.05);
    }
    #info {
        margin-top: 30px;
        font-size: 18px;
        color: #333;
    }
    #todayTime {
        font-weight: bold;
        color: #007BFF;
    }
</style>
</head>
<body>
    <h1>ポモドーロタイマー</h1>

    <div id="timer">00:00:00</div>

    <div class="buttons">
        <button id="startBtn">開始</button>
        <button id="pauseBtn">中断</button>
        <button id="stopBtn" onclick="goHome()">終了</button>
    </div>

    <div id="info">
        今日の合計勉強時間：<span id="todayTime">00:00:00</span>
    </div>

<script>
    let startTime = 0;
    let elapsedTime = 0;
    let timerInterval;
    let isRunning = false;

    const timerDisplay = document.getElementById("timer");
    const todayTimeDisplay = document.getElementById("todayTime");

    function getJSTDateKey() {
        const now = new Date();
        now.setHours(now.getHours() + 9);
        return now.toISOString().split("T")[0];
    }

    const todayKey = getJSTDateKey();

    function loadTodayStudyTime() {
        const savedData = JSON.parse(localStorage.getItem("fixeve_study_log") || "{}");
        const todaySeconds = savedData[todayKey] || 0;
        todayTimeDisplay.textContent = formatTime(todaySeconds);
        return todaySeconds;
    }

    let totalToday = loadTodayStudyTime();

    function formatTime(sec) {
        const h = String(Math.floor(sec / 3600)).padStart(2, "0");
        const m = String(Math.floor((sec % 3600) / 60)).padStart(2, "0");
        const s = String(sec % 60).padStart(2, "0");
        return `${h}:${m}:${s}`;
    }

    function updateTimer() {
        const now = Date.now();
        elapsedTime = Math.floor((now - startTime) / 1000);
        timerDisplay.textContent = formatTime(elapsedTime);
    }

    document.getElementById("startBtn").onclick = () => {
        if (!isRunning) {
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
            isRunning = true;
        }
    };

    document.getElementById("pauseBtn").onclick = () => {
        if (isRunning) {
            clearInterval(timerInterval);
            isRunning = false;
            totalToday += elapsedTime;
            saveTodayTime(totalToday);
            elapsedTime = 0;
            timerDisplay.textContent = "00:00:00";
            todayTimeDisplay.textContent = formatTime(totalToday);
        }
    };

    function goHome() {
        if (isRunning) {
            clearInterval(timerInterval);
            totalToday += elapsedTime;
            saveTodayTime(totalToday);
        }
        window.location.href = "https://fixeve.github.io/fixeve-home/";
    }

    function saveTodayTime(seconds) {
        const savedData = JSON.parse(localStorage.getItem("fixeve_study_log") || "{}");
        savedData[todayKey] = seconds;
        localStorage.setItem("fixeve_study_log", JSON.stringify(savedData));
    }

    function watchMidnight() {
        setInterval(() => {
            const currentKey = getJSTDateKey();
            if (currentKey !== todayKey) location.reload();
        }, 60000);
    }

    watchMidnight();
</script>
</body>
</html>
